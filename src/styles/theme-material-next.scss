// Colors
$primary-opacity: .87;
$secondary-opacity: .54;
$disabled-opacity: .38;

$accent: #4285F4;
$primary: rgba(black, $primary-opacity);
$secondary: rgba(black, $secondary-opacity);
$disabled: rgba(black, $disabled-opacity);
$hint: rgba(black, $disabled-opacity);
$icon: rgba(black, $disabled-opacity);

$hover: #EEEEEE;
$selected: #F5F5F5;
$background-color: #FFFFFF;
$editor-background: #F5F5F5;
$panel-background: #EEEEEE;
$border-color: #E0E0E0;
$chip-background: #E0E0E0;

$primary-font-size: 13px;
$primary-font: "Roboto", sans-serif;
$primary-weight: 400;

$secondary-font: "Roboto", sans-serif;
$secondary-font-size: 12px;
$secondary-weight: 700;
$grid-size: 8px;
$icon-size: 18px;

$header-height: $grid-size * 7;
$row-height: $grid-size * 6;
$cell-horizontal-padding: $grid-size* 3;
$transition-speed: 120ms;

@mixin bottom-border() {
    border-bottom: 1px solid $border-color;
    box-sizing: border-box;
}

@mixin centered-container($height) {
    line-height: $height;
}

@mixin grid-cell($height) {
    padding-left: $cell-horizontal-padding;
    padding-right: $cell-horizontal-padding;
    @include centered-container($height);
}

@mixin icon-background($icon) {
    width: $icon-size;
    height: $icon-size;
    background: transparent url('./material-icons/#{$icon}.svg') center no-repeat;
    background-size: $icon-size $icon-size;
    opacity: primary-opacity;
}

@mixin accent-icon($icon) {
    background: $accent none;
    mask: url("./material-icons/#{$icon}.svg") no-repeat 50% 50%;
}

@mixin card() {
    box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);
    padding: $grid-size;
    background: $background-color;
    border-radius: 2px;
}

@mixin simple-material-textbox {
    border: 0;
    background: transparent;
    font-size: inherit;
    font-family: inherit;

    box-sizing: border-box;
    border-bottom: 1px solid $border-color;
    height: $grid-size * 3;
    padding-bottom: $grid-size;
    color: $primary;

    &:focus {
        border-bottom: 2px solid $accent;
        padding-bottom: $grid-size - 1;
        outline: none;
    }

    &::placeholder {
        color: $disabled;
    }
}

@mixin simple-material-flat-button {
    -webkit-appearance: none;
    background: transparent;
    border: 0;
    color: $accent;
    text-transform: uppercase;
    font-family: inherit;
    font-size: inherit;
    padding: 0;
    margin: 0;
}

@mixin hide-text {
    text-indent: 100%;
    overflow: hidden;
}
.ag-material-next {
    font: $primary-weight $primary-font-size $primary-font;
    color: $primary;
    background-color: $background-color;

////////////////////////////////////////
// Basic layout
////////////////////////////////////////
    .ag-header {
        font: $secondary-weight $secondary-font-size $secondary-font;
        color: $secondary;
    }

    .ag-header-row {
        @include bottom-border;
    }

    .ag-row {
        @include bottom-border;
        transition: background-color $transition-speed linear;
    }

    .ag-row-hover {
        background-color: $hover;
    }

    .ag-numeric-cell {
        text-align: right;
    }

    .ag-header-cell-label {
        float: left;
        width: calc(100% - #{$icon-size});
        & > span {
            float: left;
        }
        .ag-header-icon {
            margin-top: 2px;
        }
    }

    .ag-numeric-header {
        .ag-header-cell-menu-button {
            float: left;
        }

        .ag-header-cell-label {
            float: right;
            & > span {
                float: right;
            }
        }
    }

    .ag-header-cell, .ag-header-group-cell {
        @include grid-cell($header-height);
    }

    .ag-cell {
        @include grid-cell($row-height - 2);
        border: 1px solid transparent;
    }

////////////////////////////////////////
// Navigation
////////////////////////////////////////
    .ag-cell:focus {
        outline: initial;
        border: 1px solid $accent;
    }

////////////////////////////////////////
// Resizing
////////////////////////////////////////
    .ag-header-cell-resize {
        width: $grid-size * 2;
        position: absolute;
        right:-$grid-size * 1;
        z-index: 4;
        &::after {
            border-right: 1px solid $border-color;
            display: block;
            height: $header-height - $grid-size * 4;
            margin-top: $grid-size * 2;
            content: 'resize';
            overflow: hidden;
            text-indent: $grid-size;
            width: $grid-size;
        }
    }

////////////////////////////////////////
// Icons
////////////////////////////////////////

    $icons: aggregation arrows asc checkbox-checked-readonly checkbox-checked checkbox-indeterminate-readonly checkbox-indeterminate checkbox-unchecked-readonly checkbox-unchecked column columns contracted copy cut desc expanded eye-slash eye filter group indeterminate left loading menu minus none not-allowed paste pin pivot plus right small-left small-right small-up small-down tick cross tree-open tree-closed;

    @each $icon in $icons {
        .ag-icon-#{$icon} {
            display: inline-block;
            @include icon-background('#{$icon}');
        }
    }

    .ag-header-cell-menu-button {
        @include icon-background('menu');
        height: $header-height;
    }

    .ag-icon-checkbox-checked {
        @include accent-icon('checkbox-checked');
    }


////////////////////////////////////////
// Context Menu
////////////////////////////////////////

    .ag-menu {
        @include card;
        padding: 0;
        z-index: 5;

        .ag-menu-list {
            & > div:first-child > span {
                padding-top: $grid-size;
            }

            & > div:last-child > span {
                padding-bottom: $grid-size;
            }

            & > div:last-child > .ag-menu-option-popup-pointer {
                background-position-y: $grid-size;
            }
        }

        .ag-menu-option {
            line-height: $grid-size * 4;
            padding-left: $grid-size * 2;
            padding-right: $grid-size * 2;

            & > span {
                vertical-align: middle;
                display: table-cell;
            }
        }

        .ag-menu-option-icon {
            padding-left: $grid-size;
            padding-right: $grid-size;

            span {
                height: $grid-size * 2;
            }
        }

        .ag-menu-option-shortcut {
            padding-left: $grid-size * 2;
        }

        $separator-size: $grid-size;
        .ag-menu-separator {
            border-bottom: 1px solid $border-color;
            margin-left: -$grid-size;

            & > span {
                height: $separator-size;
            }
        }

        .ag-menu-separator + .ag-menu-option > span {
            padding-top: $separator-size;
        }

        .ag-menu-option-popup-pointer {
            width:$icon-size + $grid-size * 2;
        }
    }

////////////////////////////////////////
// Column Reordering
////////////////////////////////////////

    &.ag-dnd-ghost {
        @include card();
        font: $secondary-weight $secondary-font-size $secondary-font;
        color: $secondary;
        border: none;
        height: $header-height !important;
        line-height: $header-height;
        z-index: 5;
        margin: 0;
        transform: translatey($grid-size * 2);
        padding: 0 $grid-size * 2;

        span, div {
            float: left;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    }

////////////////////////////////////////
// Column Filter
////////////////////////////////////////

    .ag-tab-header {
        background: $panel-background;
        display: table;
        width: 100%;

        .ag-tab {
            display: table-cell;
            height: $grid-size * 4;
            vertical-align: middle;
            text-align: center;
            border-bottom: 2px solid transparent;

            &.ag-tab-selected {
                border-bottom: 2px solid $accent;

                $icons: filter columns menu;

                @each $icon in $icons {
                    .ag-icon-#{$icon} {
                        display: inline-block;
                        @include accent-icon($icon);
                    }
                }
            }
        }
    }

    .ag-tab-body {
        padding: $grid-size 0;

        // string filter type
        .ag-filter-select {
            margin: $grid-size;
            width: calc(100% - #{$grid-size * 2});
        }

        .ag-menu-list {
            & > div:first-child > span {
                padding-top: 0;
            }

            & > div:last-child > span {
                padding-bottom: 0;
            }

            & > div:last-child > .ag-menu-option-popup-pointer {
                background-position-y: 0;
            }
        }
    }

    // forced by the JS implementation
    $virtual-item-height: 32px;

////////////////////////////////////////
// Value Set Filter
////////////////////////////////////////

    .ag-filter {
        & > div > div > div {
        }

        input[type=text], input[type=date] {
            @include simple-material-textbox;
            padding-left: $grid-size;
        }

        label {
            display: block;
            padding-left: $grid-size;
        }

        .ag-set-filter-list {
            padding-top: $grid-size;
        }

        .ag-filter-header-container {
            height: $virtual-item-height;
            box-sizing: border-box;
        }

        .ag-filter-header-container:nth-child(2) {
            border-bottom: 1px solid $border-color;
        }

        .ag-filter-checkbox {
            float: left;
            margin-right: $grid-size;
            height: $virtual-item-height;
            padding-top: $grid-size / 2;
        }

        .ag-filter-value {
            height: $virtual-item-height;
            float: left;
            line-height: $grid-size * 3.5; // hate this
        }

        .ag-filter-apply-panel {
            padding: $grid-size;
            padding-top: $grid-size * 2;
            display: flex;
            justify-content: flex-end;

            button {
                @include simple-material-flat-button;
            }

            button + button {
                margin-left: $grid-size * 2;
            }
        }
    }

////////////////////////////////////////
// Column selector
////////////////////////////////////////
    .ag-column-select-panel {

        .ag-column-select-column-group::not(::first-child) {
            border-top: 1px solid $border-color;
        }

        .ag-column-select-column-group, 
        .ag-column-select-column {
            height: $grid-size * 4;
            line-height: $grid-size * 4;
            margin-left: $grid-size;

            span {
                float: left;
                height: 100%;
            }

            .ag-column-select-indent {
                width: $grid-size * 2;
            }

            .ag-column-select-checkbox, .ag-column-group-icons {
                margin-right: $grid-size;
            }
        } 
        .ag-column-select-column {
            // this is a very crude approximation, because we have one 10px hard-coded element in there.
            margin-left: $icon-size + $grid-size * 3;
        }
    }

////////////////////////////////////////
// Tool panel
////////////////////////////////////////

    .ag-tool-panel {
        border-right: 0;
        background-color: #FAFAFA;

        .ag-pivot-mode {
            height: $header-height;
            border-bottom: 1px solid $border-color;
            box-sizing: border-box;
            line-height: $header-height;

            span {
                float: left;
                height: 100%;
            }

            .ag-pivot-mode-select {
                margin-left: $grid-size;

                .ag-checkbox-label {
                    margin-left: $grid-size;
                }
            }
        }

        .ag-column-select-panel {
            padding: $grid-size 0;
        }

        $group-height: $grid-size * 5;

        .ag-column-drop {
            border-top: 1px solid $border-color;
            padding: $grid-size 0;
            padding-bottom: $grid-size * 2;
            clear: both;

            .ag-icon {
                float: left;
                height: $group-height;
                margin:0 $grid-size;
            }

            .ag-column-drop-title {
                line-height: $group-height;
                height: $group-height;
                float: left;
                width: calc(100% - #{$icon-size + $grid-size * 2});
                clear: right;
            }
            
            .ag-column-drop-empty-message {
                clear: both;
                font: $secondary-weight $secondary-font-size $secondary-font;
                color: $disabled;
                padding-left: $grid-size * 4;
                padding-right: $grid-size;
                line-height: $grid-size * 2;
            }
        }
    }

////////////////////////////////////////
// Sorting
////////////////////////////////////////
    .ag-filter-icon {
        @include icon-background('filter');
    }

    .ag-sort-ascending-icon {
        @include icon-background('asc');
    }

    .ag-sort-descending-icon {
        @include icon-background('desc');
    }

    .ag-sort-none-icon {
        @include icon-background('none');
    }

    $header-icon-size: 14px;

    .ag-header-cell-label .ag-header-icon {
        margin: 0;
        height: 100%;
        background-size: $header-icon-size $header-icon-size;
        background-position-y: $grid-size * 2.5;
        margin-left: $grid-size;
        opacity: $primary-opacity;
    }

    .ag-numeric-header .ag-header-cell-label .ag-header-icon {
        margin-left: 0;
        margin-right: $grid-size;
    }

////////////////////////////////////////
// Pagination
////////////////////////////////////////
    .ag-paging-panel {
        border-top: 1px solid $border-color;
        height: $header-height;
        display: flex;
        align-items: center;
        padding: 0 $grid-size * 3;
        justify-content: flex-end;
        color: $secondary;

        & > span {
            margin-left: $grid-size * 4;
        }

        $buttonIcons: (
            btFirst: first,
            btPrevious: previous,
            btLast: last,
            btNext: next
        );

        @each $ref, $icon in $buttonIcons {
            button[ref=#{$ref}] {
                -webkit-appearance: none;
                border: none;
                padding: 0;

                @include icon-background($icon);
                @include hide-text;
                opacity: $secondary-opacity;

                &[disabled] {
                    opacity: $disabled-opacity;
                }
            }
        }
    }

////////////////////////////////////////
// Selection
////////////////////////////////////////

    .ag-row-selected {
        background-color: $selected;
    }

    .ag-cell-range-selected {
        background-color: $selected;
    }

////////////////////////////////////////
// Editing
////////////////////////////////////////

    .ag-cell-inline-editing {
        @include card;
        height: $row-height + $grid-size * 3;
        z-index: 2;
        background: $editor-background;
        padding: $grid-size * 3;
        line-height: normal;

        input[type=text] {
            @include simple-material-textbox;
        } 

        select {
            height: auto;
        }
    }

    .ag-popup-editor {
        @include card;
        padding: 0;
        background: $editor-background;

        .ag-large-textarea textarea {
            padding: $grid-size * 3;
            @include simple-material-textbox;
            height: auto;
        }
    }
////////////////////////////////////////
// Rich Select
////////////////////////////////////////
    $rich-select-item-height: $row-height;
    .ag-rich-select {
        background: $editor-background;
        background-image: url("./material-icons/tree-open.svg");
        background-position-y: $grid-size * 2;
        background-position-x: calc(100% - #{$grid-size});
        background-repeat: no-repeat;
        .ag-rich-select-list {
            height: auto; // not sure why the structure had minimum height, does not look right
        }

        .ag-rich-select-value {
            line-height: $row-height;
            height: $row-height;
            padding-left: $grid-size * 3;
        }

        .ag-virtual-list-item  {
            cursor: default;
            height: $rich-select-item-height;
            line-height: $rich-select-item-height;
            padding-left: $grid-size * 3;

            &:hover {
                background-color: $hover;
            }
        }
    }

////////////////////////////////////////
// Floating filter
////////////////////////////////////////
    .ag-floating-filter-body {
        float: left;
        width: calc(100% - #{$grid-size} * 4);
        margin-right: 0;
        height: 100%;
        padding-top: $grid-size * 2;

        input {
            @include simple-material-textbox;
        }
    }

    .ag-floating-filter-button {
        padding-top: $grid-size * 2.5;
        float: right;
        button {
            @include simple-material-flat-button;
            @include icon-background('filter');
            @include hide-text;
        }
    }

////////////////////////////////////////
// Expanding headers
////////////////////////////////////////
    .ag-header-group-cell-label {
        span {
            float: left;
            height: 100%;
        }
    }

////////////////////////////////////////
// Header checkbox selection
////////////////////////////////////////
    .ag-header-select-all {
        margin-right: $grid-size * 3;
        height: 100%;

        span {
            height: 100%;
        }
    }

    .ag-header-select-all:not(.ag-hidden) + .ag-cell-label-container {
        width: calc(100% - #{$icon-size} - #{$grid-size * 3});
        float: left;
    }

////////////////////////////////////////
// Selection checkbox
////////////////////////////////////////
    .ag-selection-checkbox, .ag-group-expanded, .ag-group-contracted {
        span {
            float: left;
            height: 100%;
            margin-right: $grid-size * 3;
        }
    }

    .ag-group-expanded {
        .ag-icon-contracted {
            @include icon-background('tree-open');
            height: 100%;
        }
    }

////////////////////////////////////////
// Column drop
////////////////////////////////////////
    .ag-column-drop-horizontal {
        height: $grid-size * 6;
        line-height: $grid-size * 4;
        background-color: $panel-background;
        padding-left: $grid-size * 3;
        span {
            height: 100%;
            float: left;
        }

        .ag-icon-group, .ag-icon-pivot {
            margin-right: $grid-size * 3;
        }

        .ag-right-arrow {
            @include icon-background('right');
        }
        .ag-left-arrow {
            @include icon-background('left');
        }

        .ag-left-arrow, .ag-right-arrow {
            @include hide-text;
            height: 100%;
            margin: 0 $grid-size;
            opacity: $secondary-opacity;
        }

        .ag-column-drop-empty-message {
            height: 100%;
            line-height: $grid-size * 6;
            opacity: $secondary-opacity;
        }

    }

    .ag-column-drop-cell {
        box-sizing: border-box;
        height: $grid-size * 4 !important;
        margin-top: $grid-size;
        padding: 0 $grid-size / 2;
        background: $chip-background;
        border-radius: $grid-size * 4;

        .ag-column-drop-cell-text {
            margin:0 $grid-size;
            height: 100%;
            line-height: $grid-size * 4;
        }

        .ag-column-drop-cell-button {
            @include icon-background('cancel');
            @include hide-text;
            height: 100%;
            opacity: $secondary-opacity;
            margin: 0 $grid-size / 2;
            &:hover {
                opacity: $primary-opacity;
            }
        }
    }

    .ag-column-drop-vertical > .ag-column-drop-cell {
        margin-top: 0;
        margin-left: $grid-size;
        margin-bottom: $grid-size;
        float: left;
    }


////////////////////////////////////////
// Right-To-Left
////////////////////////////////////////
    .ag-rtl {
        .ag-numeric-cell {
            text-align: left;
        }

        .ag-header-cell-menu-button {
            float: left;
        }
        .ag-header-cell-label {
            float: right;
            width: calc(100% - #{$icon-size});
            & > span {
                float: right;
            }
            .ag-header-icon {
                margin-top: 2px;
            }
        }

        .ag-numeric-header {
            .ag-header-cell-menu-button {
                float: right;
            }

            .ag-header-cell-label {
                float: left;
                & > span {
                    float: left;
                }
            }
        }


        .ag-tool-panel {
            .ag-pivot-mode {
                span {
                    float: right;
                }

                .ag-pivot-mode-select {
                    margin-right: $grid-size;

                    .ag-checkbox-label {
                        margin-right: $grid-size;
                    }
                }
            }


            .ag-column-drop {
                .ag-icon {
                    float: right;
                }

                .ag-column-drop-title {
                    float: right;
                    clear: left;
                }

                .ag-column-drop-empty-message {
                    padding-right: $grid-size * 4;
                    padding-left: $grid-size;
                }
            }
        }

        .ag-filter-checkbox {
            float: right;
            margin-left: $grid-size;
        }

        .ag-filter-value {
            float: right;
        }

        .ag-column-select-panel {

            .ag-column-select-column-group, 
            .ag-column-select-column {
                margin-right: $grid-size;
                span {
                    float: right;
                }

                .ag-column-select-checkbox, .ag-column-group-icons {
                    margin-left: $grid-size;
                }
            } 
            .ag-column-select-column {
                // this is a very crude approximation, because we have one 10px hard-coded element in there.
                margin-right: $icon-size + $grid-size * 3;
                margin-left: 0;
            }
        }

        .ag-icon-tree-closed {
            @include icon-background('contracted');
        }

        .ag-header-group-cell-label {
            height: 100%;
            span {
                float: right;
                height: 100%;
            }
        }

        .ag-header-select-all:not(.ag-hidden) + .ag-cell-label-container {
            float: right;
        }

        .ag-header-select-all {
            margin-left: $grid-size * 3;
            margin-right: 0;
        }

        .ag-cell-label-container {
            height: 100%;
        }
        .ag-header-cell-label {
            height: 100%;
            span {
                height: 100%;
            }
        }

        .ag-selection-checkbox, .ag-group-expanded, .ag-group-contracted {
            span {
                float: right;
            }
        }

        .ag-column-drop-horizontal {
            padding-right: $grid-size * 3;
            span {
                float: right;
            }

            .ag-icon-group, .ag-icon-pivot {
                margin-left: $grid-size * 3;
                margin-right: 0;
            }

            .ag-right-arrow {
                @include icon-background('right');
                height: 100%;
            }

            .ag-left-arrow {
                @include icon-background('left');
                height: 100%;
            }
        }

        .ag-floating-filter-body {
            float: right;
            margin-left: 0;
        }

        .ag-floating-filter-button {
            float: left;
        }

        .ag-header-group-cell-label {
            span {
                float: right;
                height: 100%;
            }
        }

    }
}
